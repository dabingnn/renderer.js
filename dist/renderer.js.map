{"version":3,"file":"renderer.js","sources":["../lib/enums.js","../lib/resources/mesh.js","../lib/resources/pass.js","../lib/resources/technique.js","../lib/utils.js","../lib/resources/material.js","../lib/scene/light.js","../lib/scene/camera.js","../lib/scene/model.js","../lib/scene/scene.js","../lib/program-lib/mustache.js","../lib/program-lib/chunks/index.js","../lib/program-lib/templates/index.js","../lib/program-lib/program-lib.js","../lib/renderer/base.js","../index.js"],"sourcesContent":["export const enums = {\n  // perspective\n  PP_PROJECTION: 0,\n  PP_ORTHO: 1,\n\n  // stages\n  STAGE_OPAQUE:       0x00000001,\n  STAGE_TRANSPARENT:  0x00000002,\n  STAGE_SHADOWCAST:   0x00000004,\n\n  // parameter type\n  PARAM_INT:             0,\n  PARAM_INT2:            1,\n  PARAM_INT3:            2,\n  PARAM_INT4:            3,\n  PARAM_FLOAT:           4,\n  PARAM_FLOAT2:          5,\n  PARAM_FLOAT3:          6,\n  PARAM_FLOAT4:          7,\n  PARAM_COLOR3:          8,\n  PARAM_COLOR4:          9,\n  PARAM_MAT2:           10,\n  PARAM_MAT3:           11,\n  PARAM_MAT4:           12,\n  PARAM_TEXTURE_2D:     13,\n  PARAM_TEXTURE_CUBE:   14,\n};\n","import gfx from 'gfx.js';\n\nexport default class Mesh {\n  constructor(vb, ib, pt = gfx.PT_TRIANGLES) {\n    this._vertexBuffer = vb;\n    this._indexBuffer = ib;\n    this._primitiveType = pt;\n\n    // TODO: this._aabb;\n  }\n}","import gfx from 'gfx.js';\n\nexport default class Pass {\n  constructor(name) {\n    this._programName = name;\n\n    // cullmode\n    this._cullMode = gfx.CULL_BACK;\n\n    // blending\n    this._blend = false;\n    this._blendEq = gfx.BLEND_FUNC_ADD;\n    this._blendAlphaEq = gfx.BLEND_FUNC_ADD;\n    this._blendSrc = gfx.BLEND_ONE;\n    this._blendDst = gfx.BLEND_ZERO;\n    this._blendSrcAlpha = gfx.BLEND_ONE;\n    this._blendDstAlpha = gfx.BLEND_ZERO;\n    this._blendColor = 0xffffffff;\n\n    // depth\n    this._depthTest = false;\n    this._depthWrite = false;\n    this._depthFunc = gfx.DS_FUNC_LESS,\n\n    // stencil\n    this._stencilTest = false;\n    // front\n    this._stencilFuncFront = gfx.DS_FUNC_ALWAYS;\n    this._stencilRefFront = 0;\n    this._stencilMaskFront = 0xff;\n    this._stencilFailOpFront = gfx.STENCIL_OP_KEEP;\n    this._stencilZFailOpFront = gfx.STENCIL_OP_KEEP;\n    this._stencilZPassOpFront = gfx.STENCIL_OP_KEEP;\n    this._stencilWriteMaskFront = 0xff;\n    // back\n    this._stencilFuncBack = gfx.DS_FUNC_ALWAYS;\n    this._stencilRefBack = 0;\n    this._stencilMaskBack = 0xff;\n    this._stencilFailOpBack = gfx.STENCIL_OP_KEEP;\n    this._stencilZFailOpBack = gfx.STENCIL_OP_KEEP;\n    this._stencilZPassOpBack = gfx.STENCIL_OP_KEEP;\n    this._stencilWriteMaskBack = 0xff;\n  }\n\n  setCullMode(cullMode) {\n    this._cullMode = cullMode;\n  }\n\n  setBlend(\n    blendEq = gfx.BLEND_FUNC_ADD,\n    blendSrc = gfx.BLEND_ONE,\n    blendDst = gfx.BLEND_ZERO,\n    blendAlphaEq = gfx.BLEND_FUNC_ADD,\n    blendSrcAlpha = gfx.BLEND_ONE,\n    blendDstAlpha = gfx.BLEND_ZERO,\n    blendColor = 0xffffffff\n  ) {\n    this._blend = true;\n    this._blendEq = blendEq;\n    this._blendSrc = blendSrc;\n    this._blendDst = blendDst;\n    this._blendAlphaEq = blendAlphaEq;\n    this._blendSrcAlpha = blendSrcAlpha;\n    this._blendDstAlpha = blendDstAlpha;\n    this._blendColor = blendColor;\n  }\n\n  setDepth(\n    depthTest = false,\n    depthWrite = false,\n    depthFunc = gfx.DS_FUNC_LESS\n  ) {\n    this._depthTest = depthTest;\n    this._depthWrite = depthWrite;\n    this._depthFunc = depthFunc;\n  }\n\n  setStencilFront(\n    stencilFunc = gfx.DS_FUNC_ALWAYS,\n    stencilRef = 0,\n    stencilMask = 0xff,\n    stencilFailOp = gfx.STENCIL_OP_KEEP,\n    stencilZFailOp = gfx.STENCIL_OP_KEEP,\n    stencilZPassOp = gfx.STENCIL_OP_KEEP,\n    stencilWriteMask = 0xff\n  ) {\n    this._stencilTest = true;\n    this._stencilFuncFront = stencilFunc;\n    this._stencilRefFront = stencilRef;\n    this._stencilMaskFront = stencilMask;\n    this._stencilFailOpFront = stencilFailOp;\n    this._stencilZFailOpFront = stencilZFailOp;\n    this._stencilZPassOpFront = stencilZPassOp;\n    this._stencilWriteMaskFront = stencilWriteMask;\n  }\n\n  setStencilBack(\n    stencilFunc = gfx.DS_FUNC_ALWAYS,\n    stencilRef = 0,\n    stencilMask = 0xff,\n    stencilFailOp = gfx.STENCIL_OP_KEEP,\n    stencilZFailOp = gfx.STENCIL_OP_KEEP,\n    stencilZPassOp = gfx.STENCIL_OP_KEEP,\n    stencilWriteMask = 0xff\n  ) {\n    this._stencilTest = true;\n    this._stencilFuncBack = stencilFunc;\n    this._stencilRefBack = stencilRef;\n    this._stencilMaskBack = stencilMask;\n    this._stencilFailOpBack = stencilFailOp;\n    this._stencilZFailOpBack = stencilZFailOp;\n    this._stencilZPassOpBack = stencilZPassOp;\n    this._stencilWriteMaskBack = stencilWriteMask;\n  }\n}","let _genID = 0;\n\nexport default class Technique {\n  /**\n   * @param {STAGE_*} stages\n   * @param {Array} parameters\n   * @param {Array} passes\n   * @param {Number} layer\n   */\n  constructor(stages, parameters, passes, layer = 0) {\n    this._id = _genID++;\n    this._stages = stages;\n    this._parameters = parameters; // {name, type, size, val}\n    this._passes = passes;\n    this._layer = layer;\n    // TODO: this._version = 'webgl' or 'webgl2' // ????\n  }\n\n  sortID () {\n    if (!this._passes.length) {\n      return -1;\n    }\n\n    return (\n      (this._passes.length & 0xf) << 24 |\n      (this._passes[0]._program.id & 0xfff) << 12 |\n      (this._id & 0xffff)\n    ) >>> 0;\n  }\n}","import gfx from 'gfx.js';\nimport Mesh from './resources/mesh';\nimport Pass from './resources/pass';\nimport Technique from './resources/technique';\nimport { enums } from './enums';\n\n/**\n * @param {gfx.Device} device\n * @param {Object} data\n */\nexport function createMesh(device, data) {\n  if (!data.positions) {\n    console.error('The data must have positions field');\n    return null;\n  }\n\n  let verts = [];\n  let vcount = data.positions.length / 3;\n\n  for (let i = 0; i < vcount; ++i) {\n    verts.push(data.positions[3 * i], data.positions[3 * i + 1], data.positions[3 * i + 2]);\n\n    if (data.normals) {\n      verts.push(data.normals[3 * i], data.normals[3 * i + 1], data.normals[3 * i + 2]);\n    }\n\n    if (data.uvs) {\n      verts.push(data.uvs[2 * i], data.uvs[2 * i + 1]);\n    }\n  }\n\n  let vfmt = [];\n  vfmt.push({ name: gfx.ATTR_POSITION, type: gfx.ATTR_TYPE_FLOAT32, num: 3 });\n  if (data.normals) {\n    vfmt.push({ name: gfx.ATTR_NORMAL, type: gfx.ATTR_TYPE_FLOAT32, num: 3 });\n  }\n  if (data.uvs) {\n    vfmt.push({ name: gfx.ATTR_UV, type: gfx.ATTR_TYPE_FLOAT32, num: 2 });\n  }\n\n  let vb = new gfx.VertexBuffer(\n    device,\n    new gfx.VertexFormat(vfmt),\n    gfx.USAGE_STATIC,\n    new Float32Array(verts),\n    vcount,\n    false\n  );\n\n  let ib = null;\n  if (data.indices) {\n    ib = new gfx.IndexBuffer(\n      device,\n      gfx.INDEX_FMT_UINT16,\n      gfx.USAGE_STATIC,\n      new Uint16Array(data.indices),\n      data.indices.length,\n      false\n    );\n  }\n\n  return new Mesh(vb, ib);\n}\n\nconst _stageMap = {\n  opaque: enums.STAGE_OPAQUE,\n  transparent: enums.STAGE_TRANSPARENT,\n  shadowcast: enums.STAGE_SHADOWCAST\n};\n\nconst _paramTypeMap = {\n  int: enums.PARAM_INT,\n  int2: enums.PARAM_INT2,\n  int3: enums.PARAM_INT3,\n  int4: enums.PARAM_INT4,\n  float: enums.PARAM_FLOAT,\n  float2: enums.PARAM_FLOAT2,\n  float3: enums.PARAM_FLOAT3,\n  float4: enums.PARAM_FLOAT4,\n  color3: enums.PARAM_COLOR3,\n  color4: enums.PARAM_COLOR4,\n  mat2: enums.PARAM_MAT2,\n  mat3: enums.PARAM_MAT3,\n  mat4: enums.PARAM_MAT4,\n  tex2d: enums.PARAM_TEXTURE_2D,\n  texcube: enums.PARAM_TEXTURE_CUBE\n};\n\nconst _cullMap = {\n  none: gfx.CULL_NONE,\n  front: gfx.CULL_FRONT,\n  back: gfx.CULL_BACK,\n  front_and_back: gfx.CULL_FRONT_AND_BACK\n};\n\nconst _blendFuncMap = {\n  add: gfx.BLEND_FUNC_ADD,\n  sub: gfx.BLEND_FUNC_SUBTRACT,\n  reverse_sub: gfx.BLEND_FUNC_REVERSE_SUBTRACT\n};\n\nconst _blendFactorMap = {\n  zero: gfx.BLEND_ZERO,\n  one: gfx.BLEND_ONE,\n  src_color: gfx.BLEND_SRC_COLOR,\n  one_minus_src_color: gfx.BLEND_ONE_MINUS_SRC_COLOR,\n  dst_color: gfx.BLEND_DST_COLOR,\n  one_minus_dst_color: gfx.BLEND_ONE_MINUS_DST_COLOR,\n  src_alpha: gfx.BLEND_SRC_ALPHA,\n  one_minus_src_alpha: gfx.BLEND_ONE_MINUS_SRC_ALPHA,\n  dst_alpha: gfx.BLEND_DST_ALPHA,\n  one_minus_dst_alpha: gfx.BLEND_ONE_MINUS_DST_ALPHA,\n  constant_color: gfx.BLEND_CONSTANT_COLOR,\n  one_minus_constant_color: gfx.BLEND_ONE_MINUS_CONSTANT_COLOR,\n  constant_alpha: gfx.BLEND_CONSTANT_ALPHA,\n  one_minus_constant_alpha: gfx.BLEND_ONE_MINUS_CONSTANT_ALPHA,\n  src_alpha_saturate: gfx.BLEND_SRC_ALPHA_SATURATE\n};\n\nconst _dsFuncMap = {\n  never: gfx.DS_FUNC_NEVER,\n  less: gfx.DS_FUNC_LESS,\n  equal: gfx.DS_FUNC_EQUAL,\n  lequal: gfx.DS_FUNC_LEQUAL,\n  greater: gfx.DS_FUNC_GREATER,\n  notequal: gfx.DS_FUNC_NOTEQUAL,\n  gequal: gfx.DS_FUNC_GEQUAL,\n  always: gfx.DS_FUNC_ALWAYS\n};\n\nconst _stencilOpMap = {\n  keep: gfx.STENCIL_OP_KEEP,\n  zero: gfx.STENCIL_OP_ZERO,\n  replace: gfx.STENCIL_OP_REPLACE,\n  incr: gfx.STENCIL_OP_INCR,\n  incr_wrap: gfx.STENCIL_OP_INCR_WRAP,\n  decr: gfx.STENCIL_OP_DECR,\n  decr_wrap: gfx.STENCIL_OP_DECR_WRAP,\n  inver: gfx.STENCIL_OP_INVERT\n};\n\n// blend packing 'func src dst'\nfunction _parseBlend(data, callback) {\n  let words = data.split(' ');\n  callback && callback(_blendFuncMap[words[0]], _blendFactorMap[words[1]], _blendFactorMap[words[2]]);\n}\n\n// stencil packing 'func ref mask failOP zfailOp passOp writeMask'\nfunction _parseStencil(data, callback) {\n  let words = data.split(' ');\n  callback && callback(_dsFuncMap[words[0]], parseInt(words[1]), parseInt(words[2]),\n    _stencilOpMap[words[3]], _stencilOpMap[words[4]], _stencilOpMap[words[5]], parseInt(words[6]));\n}\n\n// depth packing 'func write'\nfunction _parseDepth(data, callback) {\n  let words = data.split(' ');\n  callback && callback(_dsFuncMap[words[0]], (words[1] === 'true'));\n}\n\n// program packing 'vertSourceIndex fragSourceInde'\nfunction _parseProgram(data, callback) {\n  let words = data.split(' ');\n  callback && callback(parseInt(words[0]), parseInt(words[1]));\n}\n\nexport function parseMaterial(device, data) {\n  let techniques = [];\n  let mtl = data;\n  mtl.techniques.forEach(techInfo => {\n    // construct passes\n    let passes = [];\n    techInfo.passes.forEach(passInfo => {\n      let program = null;\n      _parseProgram(passInfo.program, (vertIndex, fragIndex) => {\n        program = new gfx.Program(device, {\n          vert: mtl.vertexShaders[vertIndex],\n          frag: mtl.fragmentShaders[fragIndex],\n        });\n        program.link();\n      });\n      let pass = new Pass(program);\n      // blend\n      if (passInfo.blend) {\n        pass._blend = true;\n        _parseBlend(passInfo.blend, (func, src, dst) => {\n          pass._blendEq = func;\n          pass._blendSrc = src;\n          pass._blendDst = dst;\n        });\n        if (passInfo.blendAlpha) {\n          _parseBlend(passInfo.blendAlpha, (func, src, dst) => {\n            pass._blendAlphaEq = func;\n            pass._blendSrcAlpha = src;\n            pass._blendDstAlpha = dst;\n          });\n        } else {\n          pass._blendAlphaEq = pass._blendEq;\n          pass._blendSrcAlpha = pass._blendSrc;\n          pass._blendDstAlpha = pass._blendDst;\n        }\n        if (passInfo.blendColor) {\n          pass._blendColor = parseInt(passInfo.blendColor);\n        }\n      }\n      // cull\n      if (passInfo.cull) {\n        pass._cullMode = _cullMap[passInfo.cull];\n      }\n      // depth\n      if (passInfo.depth) {\n        pass._depthTest = true;\n        _parseDepth(passInfo.depth, (func, write) => {\n          pass._depthFunc = func;\n          pass._depthWrite = write;\n        })\n      }\n      // stencil\n      if (passInfo.stencil) {\n        pass._stencilTest = true;\n        // \"func ref mask failOp zFailOp zPassOp writeMask\"\n        _parseStencil(passInfo.stencil, (func, ref, mask, failOp, zFailOp, zPassOp, writeMask) => {\n          pass._stencilFuncFront = func;\n          pass._stencilRefFront = func;\n          pass._stencilMaskFront = mask;\n          pass._stencilFailOpFront = failOp;\n          pass._stencilZFailOpFront = zFailOp;\n          pass._stencilZPassOpFront = zPassOp;\n          pass._stencilWriteMaskFront = writeMask;\n        });\n\n        if (passInfo.stencilBack) {\n          _parseStencil(passInfo.stencilBack, (func, ref, mask, failOp, zFailOp, zPassOp, writeMask) => {\n            pass._stencilFuncBack = func;\n            pass._stencilRefBack = func;\n            pass._stencilMaskBack = mask;\n            pass._stencilFailOpBack = failOp;\n            pass._stencilZFailOpBack = zFailOp;\n            pass._stencilZPassOpBack = zPassOp;\n            pass._stencilWriteMaskBack = writeMask;\n          });\n        } else {\n          pass._stencilFuncBack = pass._stencilFuncFront;\n          pass._stencilRefBack = pass._stencilRefFront;\n          pass._stencilMaskBack = pass._stencilMaskFront;\n          pass._stencilFailOpBack = pass._stencilFailOpFront;\n          pass._stencilZFailOpBack = pass._stencilZFailOpFront;\n          pass._stencilZPassOpBack = pass._stencilZPassOpFront;\n          pass._stencilWriteMaskBack = pass._stencilWriteMaskFront;\n        }\n      }\n      passes.push(pass);\n    });\n    let stage = 0;\n    techInfo.stages.split(' ').forEach(stageInfo => {\n      stage = stage | _stageMap[stageInfo];\n    });\n    let params = [];\n    for (let paramKey in techInfo.parameters) {\n      params.push({\n        name: paramKey,\n        type: _paramTypeMap[techInfo.parameters[paramKey].type]\n      });\n    }\n    let tech = new Technique(\n      stage,\n      params,\n      passes\n    );\n    techniques.push(tech);\n  });\n\n  return techniques;\n}","export default class Material {\n  /**\n   * @param {Array} techniques\n   */\n  constructor(techniques, values = {}, opts = {}) {\n    this._techniques = techniques;\n    this._values = values;\n    this._options = opts;\n\n    // TODO: check if params is valid for current technique???\n  }\n\n  getTechnique(stage) {\n    for (let i = 0; i < this._techniques.length; ++i) {\n      let tech = this._techniques[i];\n      if (tech._stages & stage) {\n        return tech;\n      }\n    }\n\n    return null;\n  }\n\n  getValue(name) {\n    return this._values[name];\n  }\n\n  setValue(name, value) {\n    // TODO: check if params is valid for current technique???\n\n    this._values[name] = value;\n  }\n\n  getOption(name) {\n    return this._options[name];\n  }\n\n  setOption(name, value) {\n    this._options[name] = value;\n  }\n}","import { color3 } from 'vmath';\n\nexport default class Light {\n  constructor() {\n    this._node = null;\n    this._color = color3.create();\n  }\n\n  setNode(node) {\n    this._node = node;\n  }\n}","import { color4, mat4 } from 'vmath';\nimport { enums } from '../enums';\n\nexport default class Camera {\n  constructor() {\n    this._node = null;\n    this._perspective = enums.PP_PROJECTION;\n\n    // projection properties\n    this._near = 0.01;\n    this._far = 1000.0;\n    this._fov = Math.PI/4.0; // vertical fov\n    // this._aspect = 16.0/9.0; // DISABLE: use _rect.w/_rect.h\n\n    // ortho properties\n    this._orthoHeight = 10;\n\n    // view properties\n    this._rect = {\n      x: 0, y: 0, w: 1, h: 1\n    };\n    this._scissor = {\n      x: 0, y: 0, w: 1, h: 1\n    };\n\n    // clear options\n    this._color = color4.create();\n    // TODO: this._clearFlags\n\n    // matrix\n    this._view = mat4.create();\n    this._proj = mat4.create();\n    this._viewProj = mat4.create();\n    this._invViewProj = mat4.create();\n  }\n\n  setNode(node) {\n    this._node = node;\n  }\n\n  updateMatrix() {\n    // view matrix\n    this._node.getWorldMatrix(this._view);\n    mat4.invert(this._view, this._view);\n\n    // projection matrix\n    // TODO: if this._projDirty\n    let aspect = this._rect.w / this._rect.h;\n    if (this._perspective === enums.PP_PROJECTION) {\n      mat4.perspective(this._proj,\n        this._fov,\n        aspect,\n        this._near,\n        this._far\n      );\n    } else {\n      let x = this._orthoHeight * aspect;\n      let y = this._orthoHeight;\n      mat4.ortho(this._proj,\n        -x, x, -y, y, this._near, this._far\n      );\n    }\n\n    // view-projection\n    mat4.mul(this._viewProj, this._proj, this._view);\n    mat4.invert(this._invViewProj, this._viewProj);\n  }\n}","export default class Model {\n  constructor() {\n    this._node = null;\n    this._meshes = [];\n    this._materials = [];\n  }\n\n  setNode(node) {\n    this._node = node;\n  }\n\n  addMesh(mesh) {\n    if (this._meshes.indexOf(mesh) !== -1) {\n      return;\n    }\n    this._meshes.push(mesh);\n  }\n\n  addMaterial(material) {\n    if (this._materials.indexOf(material) !== -1) {\n      return;\n    }\n    this._materials.push(material);\n  }\n\n  get meshCount() {\n    return this._meshes.length;\n  }\n\n  getDrawItem(out, index) {\n    if (index >= this._meshes.length ) {\n      out.node = null;\n      out.mesh = null;\n      out.material = null;\n\n      return;\n    }\n\n    out.node = this._node;\n    out.mesh = this._meshes[index];\n    if (index < this._materials.length) {\n      out.material = this._materials[index];\n    } else {\n      out.material = this._materials[this._materials.length-1];\n    }\n  }\n}","import { FixedArray } from 'memop';\n\nexport default class Scene {\n  constructor() {\n    this._lights = new FixedArray(16);\n    this._models = new FixedArray(16);\n  }\n\n  addModel(model) {\n    let idx = this._models.indexOf(model);\n    if (idx === -1) {\n      this._models.push(model);\n    }\n  }\n\n  removeModel(model) {\n    let idx = this._models.indexOf(model);\n    if (idx !== -1) {\n      this._models.fastRemove(idx);\n    }\n  }\n}","/*!\n * mustache.js - Logic-less {{mustache}} templates with JavaScript\n * http://github.com/janl/mustache.js\n */\n\nlet mustache = {};\n\nvar objectToString = Object.prototype.toString;\nvar isArray = Array.isArray || function isArrayPolyfill(object) {\n  return objectToString.call(object) === '[object Array]';\n};\n\nfunction isFunction(object) {\n  return typeof object === 'function';\n}\n\n/**\n * More correct typeof string handling array\n * which normally returns typeof 'object'\n */\nfunction typeStr(obj) {\n  return isArray(obj) ? 'array' : typeof obj;\n}\n\nfunction escapeRegExp(string) {\n  return string.replace(/[\\-\\[\\]{}()*+?.,\\\\\\^$|#\\s]/g, '\\\\$&');\n}\n\n/**\n * Null safe way of checking whether or not an object,\n * including its prototype, has a given property\n */\nfunction hasProperty(obj, propName) {\n  return obj != null && typeof obj === 'object' && (propName in obj);\n}\n\n// Workaround for https://issues.apache.org/jira/browse/COUCHDB-577\n// See https://github.com/janl/mustache.js/issues/189\nvar regExpTest = RegExp.prototype.test;\nfunction testRegExp(re, string) {\n  return regExpTest.call(re, string);\n}\n\nvar nonSpaceRe = /\\S/;\nfunction isWhitespace(string) {\n  return !testRegExp(nonSpaceRe, string);\n}\n\nvar entityMap = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#39;',\n  '/': '&#x2F;',\n  '`': '&#x60;',\n  '=': '&#x3D;'\n};\n\nfunction escapeHtml(string) {\n  return String(string).replace(/[&<>\"'`=\\/]/g, function fromEntityMap(s) {\n    return entityMap[s];\n  });\n}\n\nvar whiteRe = /\\s*/;\nvar spaceRe = /\\s+/;\nvar equalsRe = /\\s*=/;\nvar curlyRe = /\\s*\\}/;\nvar tagRe = /#|\\^|\\/|>|\\{|&|=|!/;\n\n/**\n * Breaks up the given `template` string into a tree of tokens. If the `tags`\n * argument is given here it must be an array with two string values: the\n * opening and closing tags used in the template (e.g. [ \"<%\", \"%>\" ]). Of\n * course, the default is to use mustaches (i.e. mustache.tags).\n *\n * A token is an array with at least 4 elements. The first element is the\n * mustache symbol that was used inside the tag, e.g. \"#\" or \"&\". If the tag\n * did not contain a symbol (i.e. {{myValue}}) this element is \"name\". For\n * all text that appears outside a symbol this element is \"text\".\n *\n * The second element of a token is its \"value\". For mustache tags this is\n * whatever else was inside the tag besides the opening symbol. For text tokens\n * this is the text itself.\n *\n * The third and fourth elements of the token are the start and end indices,\n * respectively, of the token in the original template.\n *\n * Tokens that are the root node of a subtree contain two more elements: 1) an\n * array of tokens in the subtree and 2) the index in the original template at\n * which the closing tag for that section begins.\n */\nfunction parseTemplate(template, tags) {\n  if (!template)\n    return [];\n\n  var sections = [];     // Stack to hold section tokens\n  var tokens = [];       // Buffer to hold the tokens\n  var spaces = [];       // Indices of whitespace tokens on the current line\n  var hasTag = false;    // Is there a {{tag}} on the current line?\n  var nonSpace = false;  // Is there a non-space char on the current line?\n\n  // Strips all whitespace tokens array for the current line\n  // if there was a {{#tag}} on it and otherwise only space.\n  function stripSpace() {\n    if (hasTag && !nonSpace) {\n      while (spaces.length)\n        delete tokens[spaces.pop()];\n    } else {\n      spaces = [];\n    }\n\n    hasTag = false;\n    nonSpace = false;\n  }\n\n  var openingTagRe, closingTagRe, closingCurlyRe;\n  function compileTags(tagsToCompile) {\n    if (typeof tagsToCompile === 'string')\n      tagsToCompile = tagsToCompile.split(spaceRe, 2);\n\n    if (!isArray(tagsToCompile) || tagsToCompile.length !== 2)\n      throw new Error('Invalid tags: ' + tagsToCompile);\n\n    openingTagRe = new RegExp(escapeRegExp(tagsToCompile[0]) + '\\\\s*');\n    closingTagRe = new RegExp('\\\\s*' + escapeRegExp(tagsToCompile[1]));\n    closingCurlyRe = new RegExp('\\\\s*' + escapeRegExp('}' + tagsToCompile[1]));\n  }\n\n  compileTags(tags || mustache.tags);\n\n  var scanner = new Scanner(template);\n\n  var start, type, value, chr, token, openSection;\n  while (!scanner.eos()) {\n    start = scanner.pos;\n\n    // Match any text between tags.\n    value = scanner.scanUntil(openingTagRe);\n\n    if (value) {\n      for (var i = 0, valueLength = value.length; i < valueLength; ++i) {\n        chr = value.charAt(i);\n\n        if (isWhitespace(chr)) {\n          spaces.push(tokens.length);\n        } else {\n          nonSpace = true;\n        }\n\n        tokens.push(['text', chr, start, start + 1]);\n        start += 1;\n\n        // Check for whitespace on the current line.\n        if (chr === '\\n')\n          stripSpace();\n      }\n    }\n\n    // Match the opening tag.\n    if (!scanner.scan(openingTagRe))\n      break;\n\n    hasTag = true;\n\n    // Get the tag type.\n    type = scanner.scan(tagRe) || 'name';\n    scanner.scan(whiteRe);\n\n    // Get the tag value.\n    if (type === '=') {\n      value = scanner.scanUntil(equalsRe);\n      scanner.scan(equalsRe);\n      scanner.scanUntil(closingTagRe);\n    } else if (type === '{') {\n      value = scanner.scanUntil(closingCurlyRe);\n      scanner.scan(curlyRe);\n      scanner.scanUntil(closingTagRe);\n      type = '&';\n    } else {\n      value = scanner.scanUntil(closingTagRe);\n    }\n\n    // Match the closing tag.\n    if (!scanner.scan(closingTagRe))\n      throw new Error('Unclosed tag at ' + scanner.pos);\n\n    token = [type, value, start, scanner.pos];\n    tokens.push(token);\n\n    if (type === '#' || type === '^') {\n      sections.push(token);\n    } else if (type === '/') {\n      // Check section nesting.\n      openSection = sections.pop();\n\n      if (!openSection)\n        throw new Error('Unopened section \"' + value + '\" at ' + start);\n\n      if (openSection[1] !== value)\n        throw new Error('Unclosed section \"' + openSection[1] + '\" at ' + start);\n    } else if (type === 'name' || type === '{' || type === '&') {\n      nonSpace = true;\n    } else if (type === '=') {\n      // Set the tags for the next time around.\n      compileTags(value);\n    }\n  }\n\n  // Make sure there are no open sections when we're done.\n  openSection = sections.pop();\n\n  if (openSection)\n    throw new Error('Unclosed section \"' + openSection[1] + '\" at ' + scanner.pos);\n\n  return nestTokens(squashTokens(tokens));\n}\n\n/**\n * Combines the values of consecutive text tokens in the given `tokens` array\n * to a single token.\n */\nfunction squashTokens(tokens) {\n  var squashedTokens = [];\n\n  var token, lastToken;\n  for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {\n    token = tokens[i];\n\n    if (token) {\n      if (token[0] === 'text' && lastToken && lastToken[0] === 'text') {\n        lastToken[1] += token[1];\n        lastToken[3] = token[3];\n      } else {\n        squashedTokens.push(token);\n        lastToken = token;\n      }\n    }\n  }\n\n  return squashedTokens;\n}\n\n/**\n * Forms the given array of `tokens` into a nested tree structure where\n * tokens that represent a section have two additional items: 1) an array of\n * all tokens that appear in that section and 2) the index in the original\n * template that represents the end of that section.\n */\nfunction nestTokens(tokens) {\n  var nestedTokens = [];\n  var collector = nestedTokens;\n  var sections = [];\n\n  var token, section;\n  for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {\n    token = tokens[i];\n\n    switch (token[0]) {\n      case '#':\n      case '^':\n        collector.push(token);\n        sections.push(token);\n        collector = token[4] = [];\n        break;\n      case '/':\n        section = sections.pop();\n        section[5] = token[2];\n        collector = sections.length > 0 ? sections[sections.length - 1][4] : nestedTokens;\n        break;\n      default:\n        collector.push(token);\n    }\n  }\n\n  return nestedTokens;\n}\n\n/**\n * A simple string scanner that is used by the template parser to find\n * tokens in template strings.\n */\nfunction Scanner(string) {\n  this.string = string;\n  this.tail = string;\n  this.pos = 0;\n}\n\n/**\n * Returns `true` if the tail is empty (end of string).\n */\nScanner.prototype.eos = function eos() {\n  return this.tail === '';\n};\n\n/**\n * Tries to match the given regular expression at the current position.\n * Returns the matched text if it can match, the empty string otherwise.\n */\nScanner.prototype.scan = function scan(re) {\n  var match = this.tail.match(re);\n\n  if (!match || match.index !== 0)\n    return '';\n\n  var string = match[0];\n\n  this.tail = this.tail.substring(string.length);\n  this.pos += string.length;\n\n  return string;\n};\n\n/**\n * Skips all text until the given regular expression can be matched. Returns\n * the skipped string, which is the entire tail if no match can be made.\n */\nScanner.prototype.scanUntil = function scanUntil(re) {\n  var index = this.tail.search(re), match;\n\n  switch (index) {\n    case -1:\n      match = this.tail;\n      this.tail = '';\n      break;\n    case 0:\n      match = '';\n      break;\n    default:\n      match = this.tail.substring(0, index);\n      this.tail = this.tail.substring(index);\n  }\n\n  this.pos += match.length;\n\n  return match;\n};\n\n/**\n * Represents a rendering context by wrapping a view object and\n * maintaining a reference to the parent context.\n */\nfunction Context(view, parentContext) {\n  this.view = view;\n  this.cache = { '.': this.view };\n  this.parent = parentContext;\n}\n\n/**\n * Creates a new context using the given view with this context\n * as the parent.\n */\nContext.prototype.push = function push(view) {\n  return new Context(view, this);\n};\n\n/**\n * Returns the value of the given name in this context, traversing\n * up the context hierarchy if the value is absent in this context's view.\n */\nContext.prototype.lookup = function lookup(name) {\n  var cache = this.cache;\n\n  var value;\n  if (cache.hasOwnProperty(name)) {\n    value = cache[name];\n  } else {\n    var context = this, names, index, lookupHit = false;\n\n    while (context) {\n      if (name.indexOf('.') > 0) {\n        value = context.view;\n        names = name.split('.');\n        index = 0;\n\n        /**\n         * Using the dot notion path in `name`, we descend through the\n         * nested objects.\n         *\n         * To be certain that the lookup has been successful, we have to\n         * check if the last object in the path actually has the property\n         * we are looking for. We store the result in `lookupHit`.\n         *\n         * This is specially necessary for when the value has been set to\n         * `undefined` and we want to avoid looking up parent contexts.\n         **/\n        while (value != null && index < names.length) {\n          if (index === names.length - 1)\n            lookupHit = hasProperty(value, names[index]);\n\n          value = value[names[index++]];\n        }\n      } else {\n        value = context.view[name];\n        lookupHit = hasProperty(context.view, name);\n      }\n\n      if (lookupHit)\n        break;\n\n      context = context.parent;\n    }\n\n    cache[name] = value;\n  }\n\n  if (isFunction(value))\n    value = value.call(this.view);\n\n  return value;\n};\n\n/**\n * A Writer knows how to take a stream of tokens and render them to a\n * string, given a context. It also maintains a cache of templates to\n * avoid the need to parse the same template twice.\n */\nfunction Writer() {\n  this.cache = {};\n}\n\n/**\n * Clears all cached templates in this writer.\n */\nWriter.prototype.clearCache = function clearCache() {\n  this.cache = {};\n};\n\n/**\n * Parses and caches the given `template` and returns the array of tokens\n * that is generated from the parse.\n */\nWriter.prototype.parse = function parse(template, tags) {\n  var cache = this.cache;\n  var tokens = cache[template];\n\n  if (tokens == null)\n    tokens = cache[template] = parseTemplate(template, tags);\n\n  return tokens;\n};\n\n/**\n * High-level method that is used to render the given `template` with\n * the given `view`.\n *\n * The optional `partials` argument may be an object that contains the\n * names and templates of partials that are used in the template. It may\n * also be a function that is used to load partial templates on the fly\n * that takes a single argument: the name of the partial.\n */\nWriter.prototype.render = function render(template, view, partials) {\n  var tokens = this.parse(template);\n  var context = (view instanceof Context) ? view : new Context(view);\n  return this.renderTokens(tokens, context, partials, template);\n};\n\n/**\n * Low-level method that renders the given array of `tokens` using\n * the given `context` and `partials`.\n *\n * Note: The `originalTemplate` is only ever used to extract the portion\n * of the original template that was contained in a higher-order section.\n * If the template doesn't use higher-order sections, this argument may\n * be omitted.\n */\nWriter.prototype.renderTokens = function renderTokens(tokens, context, partials, originalTemplate) {\n  var buffer = '';\n\n  var token, symbol, value;\n  for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {\n    value = undefined;\n    token = tokens[i];\n    symbol = token[0];\n\n    if (symbol === '#') value = this.renderSection(token, context, partials, originalTemplate);\n    else if (symbol === '^') value = this.renderInverted(token, context, partials, originalTemplate);\n    else if (symbol === '>') value = this.renderPartial(token, context, partials, originalTemplate);\n    else if (symbol === '&') value = this.unescapedValue(token, context);\n    else if (symbol === 'name') value = this.escapedValue(token, context);\n    else if (symbol === 'text') value = this.rawValue(token);\n\n    if (value !== undefined)\n      buffer += value;\n  }\n\n  return buffer;\n};\n\nWriter.prototype.renderSection = function renderSection(token, context, partials, originalTemplate) {\n  var self = this;\n  var buffer = '';\n  var value = context.lookup(token[1]);\n\n  // This function is used to render an arbitrary template\n  // in the current context by higher-order sections.\n  function subRender(template) {\n    return self.render(template, context, partials);\n  }\n\n  if (!value) return;\n\n  if (isArray(value)) {\n    for (var j = 0, valueLength = value.length; j < valueLength; ++j) {\n      buffer += this.renderTokens(token[4], context.push(value[j]), partials, originalTemplate);\n    }\n  } else if (typeof value === 'object' || typeof value === 'string' || typeof value === 'number') {\n    buffer += this.renderTokens(token[4], context.push(value), partials, originalTemplate);\n  } else if (isFunction(value)) {\n    if (typeof originalTemplate !== 'string')\n      throw new Error('Cannot use higher-order sections without the original template');\n\n    // Extract the portion of the original template that the section contains.\n    value = value.call(context.view, originalTemplate.slice(token[3], token[5]), subRender);\n\n    if (value != null)\n      buffer += value;\n  } else {\n    buffer += this.renderTokens(token[4], context, partials, originalTemplate);\n  }\n  return buffer;\n};\n\nWriter.prototype.renderInverted = function renderInverted(token, context, partials, originalTemplate) {\n  var value = context.lookup(token[1]);\n\n  // Use JavaScript's definition of falsy. Include empty arrays.\n  // See https://github.com/janl/mustache.js/issues/186\n  if (!value || (isArray(value) && value.length === 0))\n    return this.renderTokens(token[4], context, partials, originalTemplate);\n};\n\nWriter.prototype.renderPartial = function renderPartial(token, context, partials) {\n  if (!partials) return;\n\n  var value = isFunction(partials) ? partials(token[1]) : partials[token[1]];\n  if (value != null)\n    return this.renderTokens(this.parse(value), context, partials, value);\n};\n\nWriter.prototype.unescapedValue = function unescapedValue(token, context) {\n  var value = context.lookup(token[1]);\n  if (value != null)\n    return value;\n};\n\nWriter.prototype.escapedValue = function escapedValue(token, context) {\n  var value = context.lookup(token[1]);\n  if (value != null)\n    return mustache.escape(value);\n};\n\nWriter.prototype.rawValue = function rawValue(token) {\n  return token[1];\n};\n\nmustache.name = 'mustache.js';\nmustache.version = '2.3.0';\nmustache.tags = ['{{', '}}'];\n\n// All high-level mustache.* functions use this writer.\nvar defaultWriter = new Writer();\n\n/**\n * Clears all cached templates in the default writer.\n */\nmustache.clearCache = function clearCache() {\n  return defaultWriter.clearCache();\n};\n\n/**\n * Parses and caches the given template in the default writer and returns the\n * array of tokens it contains. Doing this ahead of time avoids the need to\n * parse templates on the fly as they are rendered.\n */\nmustache.parse = function parse(template, tags) {\n  return defaultWriter.parse(template, tags);\n};\n\n/**\n * Renders the `template` with the given `view` and `partials` using the\n * default writer.\n */\nmustache.render = function render(template, view, partials) {\n  if (typeof template !== 'string') {\n    throw new TypeError('Invalid template! Template should be a \"string\" ' +\n      'but \"' + typeStr(template) + '\" was given as the first ' +\n      'argument for mustache#render(template, view, partials)');\n  }\n\n  return defaultWriter.render(template, view, partials);\n};\n\n// This is here for backwards compatibility with 0.4.x.,\n/*eslint-disable */ // eslint wants camel cased function name\nmustache.to_html = function to_html(template, view, partials, send) {\n  /*eslint-enable*/\n\n  var result = mustache.render(template, view, partials);\n\n  if (isFunction(send)) {\n    send(result);\n  } else {\n    return result;\n  }\n};\n\n// Export the escaping function so that the user may override it.\n// See https://github.com/janl/mustache.js/issues/244\nmustache.escape = escapeHtml;\n\n// Export these mainly for testing, but also for advanced usage.\nmustache.Scanner = Scanner;\nmustache.Context = Context;\nmustache.Writer = Writer;\n\nexport default mustache;","export default {\n  'skinning.vert': 'attribute vec4 a_weight;\\nattribute vec4 a_joint;\\nuniform sampler2D u_bonesTexture;\\nuniform float u_bonesTextureSize;\\nmat4 getBoneMatrix(const in float i) {\\n  float size = u_bonesTextureSize;\\n  float j = i * 4.0;\\n  float x = mod(j, size);\\n  float y = floor(j / size);\\n  float dx = 1.0 / size;\\n  float dy = 1.0 / size;\\n  y = dy * (y + 0.5);\\n  vec4 v1 = texture2D(u_bonesTexture, vec2(dx * (x + 0.5), y));\\n  vec4 v2 = texture2D(u_bonesTexture, vec2(dx * (x + 1.5), y));\\n  vec4 v3 = texture2D(u_bonesTexture, vec2(dx * (x + 2.5), y));\\n  vec4 v4 = texture2D(u_bonesTexture, vec2(dx * (x + 3.5), y));\\n  return mat4(v1, v2, v3, v4);\\n}\\nmat4 skinMatrix() {\\n  return\\n    getBoneMatrix(a_joint.x) * a_weight.x +\\n    getBoneMatrix(a_joint.y) * a_weight.y +\\n    getBoneMatrix(a_joint.z) * a_weight.z +\\n    getBoneMatrix(a_joint.w) * a_weight.w\\n    ;\\n}',\n  'unpack-normal.frag': 'vec3 unpackNormal(vec4 nmap) {\\n  return nmap.xyz * 2.0 - 1.0;\\n}',\n};","export default [\n  {\n    name: 'simple',\n    vert: '\\nattribute vec3 a_position;\\nuniform mat4 model;\\nuniform mat4 viewProj;\\n{{#useTexture}}\\n  attribute vec2 a_uv;\\n  varying vec2 uv;\\n{{/useTexture}}\\nvoid main () {\\n  vec4 pos = viewProj * model * vec4(a_position, 1);\\n  {{#useTexture}}\\n    uv = a_uv;\\n  {{/useTexture}}\\n  gl_Position = pos;\\n}',\n    frag: '\\n{{#useTexture}}\\n  uniform sampler2D mainTexture;\\n  varying vec2 uv;\\n{{/useTexture}}\\n{{#useColor}}\\n  uniform vec4 color;\\n{{/useColor}}\\nvoid main () {\\n  vec4 o = vec4(1, 1, 1, 1);\\n  {{#useTexture}}\\n    o *= texture2D(mainTexture, uv);\\n  {{/useTexture}}\\n  {{#useColor}}\\n    o *= color;\\n  {{/useColor}}\\n  if (!gl_FrontFacing) {\\n    o.rgb *= 0.5;\\n  }\\n  gl_FragColor = o;\\n}',\n    options: [\n      { name: 'useTexture', },\n      { name: 'useColor', },\n    ],\n  },\n];","import gfx from 'gfx.js';\nimport mustache from './mustache';\nimport builtinChunks from './chunks/index.js';\nimport builtinTemplates from './templates/index.js';\n\nexport default class ProgramLib {\n  /**\n   * @param {gfx.Device} device\n   * @param {Array} templates\n   * @param {Object} chunks\n   */\n  constructor(device, templates = [], chunks = {}) {\n    this._device = device;\n    this._precision = `precision highp float;\\n`;\n\n    // register templates\n    this._templates = {};\n    for (let i = 0; i < builtinTemplates.length; ++i) {\n      let tmpl = builtinTemplates[i];\n      this.define(tmpl.name, tmpl.vert, tmpl.frag, tmpl.options);\n    }\n    for (let i = 0; i < templates.length; ++i) {\n      let tmpl = templates[i];\n      this.define(tmpl.name, tmpl.vert, tmpl.frag, tmpl.options);\n    }\n\n    // register chunks\n    this._chunks = {};\n    Object.assign(this._chunks, builtinChunks);\n    Object.assign(this._chunks, chunks);\n\n    this._cache = {};\n  }\n\n  /**\n   * @param {string} name\n   * @param {string} template\n   * @param {Array} options\n   *\n   * @example:\n   *   programLib.define('foobar', vertTmpl, fragTmpl, [\n   *     { name: 'shadow' },\n   *     { name: 'lightCount', min: 1, max: 4 }\n   *   ]);\n   */\n  define(name, vert, frag, options) {\n    if (this._templates[name]) {\n      console.warn(`Failed to define shader ${name}: already exists.`);\n      return;\n    }\n\n    // calculate option mask offset\n    let offset = 0;\n    for (let i = 0; i < options.length; ++i) {\n      let op = options[i];\n      op._offset = offset;\n\n      let cnt = 1;\n\n      if (op.min !== undefined && op.max !== undefined) {\n        cnt = Math.ceil((op.max - op.min) * 0.5);\n\n        op._map = function (value) {\n          return (value - this._min) << op._offset;\n        }.bind(op);\n      } else {\n        op._map = function (value) {\n          if (value) {\n            return 1 << op._offset;\n          }\n          return 0;\n        }.bind(op);\n      }\n\n      offset += cnt;\n\n      op._offset = offset;\n    }\n\n    vert = this._precision + vert;\n    frag = this._precision + frag;\n\n    // pre-parse the vs and fs template to speed up `mustache.render()` method\n    mustache.parse(vert);\n    mustache.parse(frag);\n\n    // store it\n    this._templates[name] = {\n      name,\n      vert,\n      frag,\n      options\n    };\n  }\n\n  /**\n   * @param {string} name\n   * @param {Object} options\n   */\n  getKey(name, options) {\n    let key = 0;\n    let tmpl = this._templates[name];\n    for (let i = 0; i < tmpl.options.length; ++i) {\n      let tmplOpts = tmpl.options[i];\n      let value = options[tmplOpts.name];\n      if (value === undefined) {\n        continue;\n      }\n\n      key |= tmplOpts._map(value);\n    }\n\n    return key;\n  }\n\n  /**\n   * @param {string} name\n   * @param {Object} options\n   */\n  getProgram(name, options) {\n    let key = this.getKey(name, options);\n    let program = this._cache[key];\n    if (program) {\n      return program;\n    }\n\n    // add includes to option\n    options.chunks = this._chunks;\n\n    // get template\n    let tmpl = this._templates[name];\n    let vert = mustache.render(tmpl.vert, options);\n    let frag = mustache.render(tmpl.frag, options);\n\n    program = new gfx.Program(this._device, {\n      vert,\n      frag\n    });\n    program.link();\n    this._cache[key] = program;\n\n    return program;\n  }\n}","import { FramePool, RecyclePool } from 'memop';\nimport { enums } from '../enums';\nimport { vec2, vec3, vec4, mat2, mat3, mat4, color3, color4 } from 'vmath';\nimport ProgramLib from '../program-lib/program-lib';\n\nlet _m3_tmp = mat3.create();\nlet _m4_tmp = mat4.create();\n\nlet _stageInfos = new FramePool(() => {\n  return {\n    stage: null,\n    items: null,\n  };\n}, 8);\n\nlet _float2_pool = new FramePool(() => {\n  return new Float32Array(2);\n}, 8);\n\nlet _float3_pool = new FramePool(() => {\n  return new Float32Array(3);\n}, 8);\n\nlet _float4_pool = new FramePool(() => {\n  return new Float32Array(4);\n}, 8);\n\nlet _float9_pool = new FramePool(() => {\n  return new Float32Array(9);\n}, 8);\n\nlet _float16_pool = new FramePool(() => {\n  return new Float32Array(16);\n}, 8);\n\nlet _int2_pool = new FramePool(() => {\n  return new Int32Array(2);\n}, 8);\n\nlet _int3_pool = new FramePool(() => {\n  return new Int32Array(3);\n}, 8);\n\nlet _int4_pool = new FramePool(() => {\n  return new Int32Array(4);\n}, 8);\n\nlet _type2uniformValue = {\n  [enums.PARAM_INT]: function (value) {\n    return value;\n  },\n\n  [enums.PARAM_INT2]: function (value) {\n    return vec2.array(_int2_pool.alloc(), value);\n  },\n\n  [enums.PARAM_INT3]: function (value) {\n    return vec3.array(_int3_pool.alloc(), value);\n  },\n\n  [enums.PARAM_INT4]: function (value) {\n    return vec4.array(_int4_pool.alloc(), value);\n  },\n\n  [enums.PARAM_FLOAT]: function (value) {\n    return value;\n  },\n\n  [enums.PARAM_FLOAT2]: function (value) {\n    return vec2.array(_float2_pool.alloc(), value);\n  },\n\n  [enums.PARAM_FLOAT3]: function (value) {\n    return vec3.array(_float3_pool.alloc(), value);\n  },\n\n  [enums.PARAM_FLOAT4]: function (value) {\n    return vec4.array(_float4_pool.alloc(), value);\n  },\n\n  [enums.PARAM_COLOR3]: function (value) {\n    return color3.array(_float3_pool.alloc(), value);\n  },\n\n  [enums.PARAM_COLOR4]: function (value) {\n    return color4.array(_float4_pool.alloc(), value);\n  },\n\n  [enums.PARAM_MAT2]: function (value) {\n    return mat2.array(_float4_pool.alloc(), value);\n  },\n\n  [enums.PARAM_MAT3]: function (value) {\n    return mat3.array(_float9_pool.alloc(), value);\n  },\n\n  [enums.PARAM_MAT4]: function (value) {\n    return mat4.array(_float16_pool.alloc(), value);\n  },\n\n  // [enums.PARAM_TEXTURE_2D]: function (value) {\n  // },\n\n  // [enums.PARAM_TEXTURE_CUBE]: function (value) {\n  // },\n};\n\nexport default class Base {\n  /**\n   * @param {gfx.Device} device\n   * @param {Object} opts\n   * @param {gfx.Texture2D} opts.defaultTexture\n   * @param {gfx.TextureCube} opts.defaultTextureCube\n   * @param {Array} opts.programTemplates\n   * @param {Object} opts.programChunks\n   */\n  constructor(device, opts) {\n    this._device = device;\n    this._programLib = new ProgramLib(device, opts.programTemplates, opts.programChunks);\n    this._opts = opts;\n    this._type2defaultValue = {\n      [enums.PARAM_INT]: 0,\n      [enums.PARAM_INT2]: vec2.new(0, 0),\n      [enums.PARAM_INT3]: vec3.new(0, 0, 0),\n      [enums.PARAM_INT4]: vec4.new(0, 0, 0, 0),\n      [enums.PARAM_FLOAT]: 0.0,\n      [enums.PARAM_FLOAT2]: vec2.new(0, 0),\n      [enums.PARAM_FLOAT3]: vec3.new(0, 0, 0),\n      [enums.PARAM_FLOAT4]: vec4.new(0, 0, 0, 0),\n      [enums.PARAM_COLOR3]: color3.new(0, 0, 0),\n      [enums.PARAM_COLOR4]: color4.new(0, 0, 0, 1),\n      [enums.PARAM_MAT2]: mat2.create(),\n      [enums.PARAM_MAT3]: mat3.create(),\n      [enums.PARAM_MAT4]: mat4.create(),\n      [enums.PARAM_TEXTURE_2D]: opts.defaultTexture,\n      [enums.PARAM_TEXTURE_CUBE]: opts.defaultTextureCube,\n    };\n    this._stage2fn = {};\n\n    this._drawItemsPools = new FramePool(() => {\n      return new RecyclePool(() => {\n        return {\n          node: null,\n          mesh: null,\n          material: null,\n        };\n      }, 100);\n    }, 16);\n\n    this._stageItemsPools = new FramePool(() => {\n      return new RecyclePool(() => {\n        return {\n          node: null,\n          mesh: null,\n          material: null,\n          technique: null,\n          zdist: -1,\n        };\n      }, 100);\n    }, 16);\n  }\n\n  _reset() {\n    this._drawItemsPools.reset();\n    this._stageItemsPools.reset();\n  }\n\n  _render(camera, scene, stages) {\n    const device = this._device;\n\n    // TODO: use camera's clearFalgs\n    device.setViewport(0, 0, camera._rect.w, camera._rect.h);\n    device.clear({\n      color: [0.3, 0.3, 0.3, 1],\n      depth: 1\n    });\n\n    // get all draw items\n    let allDrawItems = this._drawItemsPools.alloc();\n    allDrawItems.reset();\n\n    for (let i = 0; i < scene._models.length; ++i) {\n      let model = scene._models.data[i];\n\n      for (let m = 0; m < model.meshCount; ++m) {\n        let drawItem = allDrawItems.add();\n        model.getDrawItem(drawItem, m);\n      }\n    }\n\n    // TODO: update frustum\n    // TODO: visbility test\n    // frustum.update(camera._viewProj);\n\n    // dispatch draw items to different stage\n    _stageInfos.reset();\n\n    for (let i = 0; i < stages.length; ++i) {\n      let stage = stages[i];\n      let stageItems = this._stageItemsPools.alloc();\n      stageItems.reset();\n\n      for (let j = 0; j < allDrawItems.length; ++j) {\n        let drawItem = allDrawItems.data[j];\n        let tech = drawItem.material.getTechnique(stage);\n\n        if (tech) {\n          let stageItem = stageItems.add();\n          stageItem.node = drawItem.node;\n          stageItem.mesh = drawItem.mesh;\n          stageItem.material = drawItem.material;\n          stageItem.technique = tech;\n          stageItem.zdist = -1;\n        }\n      }\n\n      let stageInfo = _stageInfos.alloc();\n      stageInfo.stage = stage;\n      stageInfo.items = stageItems;\n    }\n\n    // render stages\n    for (let i = 0; i < _stageInfos.length; ++i) {\n      let info = _stageInfos.data[i];\n      let fn = this._stage2fn[info.stage];\n\n      fn(camera, info.items);\n    }\n  }\n\n  _draw(item) {\n    const device = this._device;\n    const programLib = this._programLib;\n    const node = item.node;\n    const mesh = item.mesh;\n    const material = item.material;\n    const technique = item.technique;\n\n    // reset the pool\n    // NOTE: we can use drawCounter optimize this\n    // TODO: should be configurable\n    _float2_pool.reset();\n    _float3_pool.reset();\n    _float4_pool.reset();\n    _float9_pool.reset();\n    _float16_pool.reset();\n    _int2_pool.reset();\n    _int3_pool.reset();\n    _int4_pool.reset();\n\n    // set common uniforms\n    // TODO: try commit this depends on material\n    // {\n    node.getWorldMatrix(_m4_tmp);\n    device.setUniform('model', mat4.array(_float16_pool.alloc(), _m4_tmp));\n\n    mat3.transpose(_m3_tmp, mat3.invert(_m3_tmp, mat3.fromMat4(_m3_tmp, _m4_tmp)));\n    device.setUniform('normalMatrix', mat3.array(_float9_pool.alloc(), _m3_tmp));\n    // }\n\n    // set technique uniforms\n    let slot = 0;\n    for (let i = 0; i < technique._parameters.length; ++i) {\n      let prop = technique._parameters[i];\n      let param = material.getValue(prop.name);\n\n      if (param === undefined) {\n        param = prop.val;\n      }\n\n      if (param === undefined) {\n        param = this._type2defaultValue[prop.type];\n      }\n\n      if (param === undefined) {\n        console.warn(`Failed to set technique property ${prop.name}, value not found.`);\n        continue;\n      }\n\n      if (\n        prop.type === enums.PARAM_TEXTURE_2D ||\n        prop.type === enums.PARAM_TEXTURE_CUBE\n      ) {\n        device.setTexture(prop.name, param, slot);\n        ++slot;\n      } else {\n        let convertFn = _type2uniformValue[prop.type];\n        let convertedValue = convertFn(param);\n        device.setUniform(prop.name, convertedValue);\n      }\n    }\n\n    // for each pass\n    for (let i = 0; i < technique._passes.length; ++i) {\n      let pass = technique._passes[i];\n      let count = mesh._vertexBuffer.count;\n\n      // set vertex buffer\n      device.setVertexBuffer(0, mesh._vertexBuffer);\n\n      // set index buffer\n      if (mesh._indexBuffer) {\n        device.setIndexBuffer(mesh._indexBuffer);\n        count = mesh._indexBuffer.count;\n      }\n\n      // set primitive type\n      device.setPrimitiveType(mesh._primitiveType);\n\n      // set program\n      let program = programLib.getProgram(pass._programName, material._options);\n      device.setProgram(program);\n\n      // cull mode\n      device.setCullMode(pass._cullMode);\n\n      // blend\n      if (pass._blend) {\n        device.enableBlend();\n        device.setBlendFuncSep(\n          pass._blendSrc,\n          pass._blendDst,\n          pass._blendSrcAlpha,\n          pass._blendDstAlpha\n        );\n        device.setBlendEqSep(\n          pass._blendEq,\n          pass._blendAlphaEq\n        );\n        device.setBlendColor32(pass._blendColor);\n      }\n\n      // depth test & write\n      if (pass._depthTest) {\n        device.enableDepthTest();\n        device.setDepthFunc(pass._depthFunc);\n      }\n      if (pass._depthWrite) {\n        device.enableDepthWrite();\n      }\n\n      // stencil\n      if (pass._stencilTest) {\n        device.enableStencilTest();\n\n        // front\n        device.setStencilFuncFront(\n          pass._stencilFuncFront,\n          pass._stencilRefFront,\n          pass._stencilMaskFront\n        );\n        device.setStencilOpFront(\n          pass._stencilFailOpFront,\n          pass._stencilZFailOpFront,\n          pass._stencilZPassOpFront,\n          pass._stencilWriteMaskFront\n        );\n\n        // back\n        device.setStencilFuncBack(\n          pass._stencilFuncBack,\n          pass._stencilRefBack,\n          pass._stencilMaskBack\n        );\n        device.setStencilOpBack(\n          pass._stencilFailOpBack,\n          pass._stencilZFailOpBack,\n          pass._stencilZPassOpBack,\n          pass._stencilWriteMaskBack\n        );\n      }\n\n      // draw pass\n      device.draw(0, count);\n    }\n  }\n}","import { enums } from './lib/enums';\nimport { createMesh, parseMaterial } from './lib/utils';\n\nimport Pass from './lib/resources/pass';\nimport Technique from './lib/resources/technique';\nimport Material from './lib/resources/material';\nimport Mesh from './lib/resources/mesh';\n\nimport Light from './lib/scene/light';\nimport Camera from './lib/scene/camera';\nimport Model from './lib/scene/model';\nimport Scene from './lib/scene/scene';\n\nimport Base from './lib/renderer/base';\nimport ProgramLib from './lib/program-lib/program-lib';\n\nlet renderer = {\n  // functions\n  createMesh,\n  parseMaterial,\n\n  // classes\n  Pass,\n  Technique,\n  Material,\n  Mesh,\n\n  Light,\n  Camera,\n  Model,\n  Scene,\n\n  Base,\n  ProgramLib,\n};\nObject.assign(renderer, enums);\n\nexport default renderer;"],"names":["const","let","this","color3","color4","mat4","FixedArray","i","tmpl","mat3","FramePool","vec2","vec3","vec4","mat2","RecyclePool","drawItem"],"mappings":"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"}